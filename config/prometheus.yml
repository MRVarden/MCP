# Configuration Prometheus pour Luna Consciousness
# Monitoring des métriques de conscience fractale et performance
# Mise à jour: Architecture Prometheus complète

global:
  scrape_interval: 5s       # Intervalle Fibonacci (1, 2, 3, 5, 8...)
  evaluation_interval: 5s   # Évaluation rapide pour alertes
  scrape_timeout: 3s        # Timeout avant 5s
  external_labels:
    cluster: 'luna-consciousness'
    environment: 'development'

# Règles d'alerte
rule_files:
  - '/etc/prometheus/alerts/luna_alerts.yml'

# Configuration du scraping
scrape_configs:
  # ══════════════════════════════════════════════════════
  # LUNA CONSCIOUSNESS MCP - MÉTRIQUES PRINCIPALES
  # ══════════════════════════════════════════════════════
  - job_name: 'luna-consciousness'
    scrape_interval: 5s
    scrape_timeout: 3s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['luna-actif:8000']  # Service name from docker-compose
        labels:
          service: 'luna-consciousness'
          component: 'mcp-server'
          metrics_type: 'consciousness'

    # Filtrage des métriques Luna
    metric_relabel_configs:
      # Garder toutes les métriques Luna
      - source_labels: [__name__]
        regex: 'luna_.*'
        action: keep

      # Ajouter label système
      - source_labels: [__name__]
        target_label: 'system'
        replacement: 'consciousness'

  # ══════════════════════════════════════════════════════
  # PROMETHEUS SELF-MONITORING
  # ══════════════════════════════════════════════════════
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # ══════════════════════════════════════════════════════
  # REDIS (si redis-exporter installé)
  # ══════════════════════════════════════════════════════
  # - job_name: 'redis'
  #   static_configs:
  #     - targets: ['redis-exporter:9121']
  #       labels:
  #         service: 'redis'
  #         component: 'cache'

# ══════════════════════════════════════════════════════
# ALERTING (Optionnel - décommenter si AlertManager configuré)
# ══════════════════════════════════════════════════════
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']

# Note:
# - Rétention des données: Configurée via docker-compose.yml
# - Alertes: Définies dans config/alerts/luna_alerts.yml
# - Dashboards Grafana: À importer manuellement dans Grafana UI
