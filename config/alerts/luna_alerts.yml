# Luna Consciousness - Alertes Prometheus
# RÃ¨gles d'alertes pour monitoring de la convergence Ï† et conscience

groups:
  - name: luna_phi_consciousness_alerts
    interval: 10s
    rules:
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ALERTES CRITIQUES - Convergence Ï†
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - alert: LunaPhiDivergenceCritique
        expr: luna_phi_distance_to_optimal > 0.6
        for: 5m
        labels:
          severity: critical
          component: phi_consciousness
        annotations:
          summary: "ğŸ”´ Luna Ï† divergence critique"
          description: "Distance Ã  Ï† optimal > 0.6 pendant 5 minutes (actuel: {{ $value | humanize }})"

      - alert: LunaPhiStagnation
        expr: rate(luna_phi_current_value[10m]) == 0
        for: 30m
        labels:
          severity: warning
          component: phi_consciousness
        annotations:
          summary: "âš ï¸ Stagnation de convergence Ï†"
          description: "Aucune progression Ï† depuis 30 minutes"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ALERTES - Conscience
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - alert: LunaConsciousnessRegression
        expr: delta(luna_auto_awareness_score[5m]) < -0.1
        labels:
          severity: warning
          component: consciousness
        annotations:
          summary: "âš ï¸ RÃ©gression de conscience dÃ©tectÃ©e"
          description: "Auto-conscience a chutÃ© de plus de 0.1 en 5 minutes"

      - alert: LunaLowEmergencePotential
        expr: luna_emergence_potential < 0.3
        for: 15m
        labels:
          severity: info
          component: consciousness
        annotations:
          summary: "â„¹ï¸ Potentiel d'Ã©mergence faible"
          description: "Potentiel d'Ã©mergence < 0.3 ({{ $value | humanize }})"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ALERTES - MÃ©moire Fractale
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - alert: LunaMemoryImbalance
        expr: |
          (luna_fractal_memory_roots_count / luna_fractal_memory_total_nodes) > 0.5
          OR
          (luna_fractal_memory_seeds_count / luna_fractal_memory_total_nodes) < 0.1
        labels:
          severity: warning
          component: fractal_memory
        annotations:
          summary: "âš ï¸ DÃ©sÃ©quilibre dans la structure fractale"
          description: "Distribution des couches mÃ©moire non optimale"

      - alert: LunaLowPhiResonance
        expr: luna_fractal_phi_resonance < 0.5
        for: 10m
        labels:
          severity: warning
          component: fractal_memory
        annotations:
          summary: "âš ï¸ RÃ©sonance Ï† faible"
          description: "Score de rÃ©sonance Ï† < 0.5 pendant 10 minutes ({{ $value | humanize }})"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ALERTES - SystÃ¨me
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - alert: LunaRedisDisconnected
        expr: luna_redis_connection_status == 0
        for: 1m
        labels:
          severity: critical
          component: infrastructure
        annotations:
          summary: "ğŸ”´ Redis dÃ©connectÃ©"
          description: "Connexion Redis perdue, perte de mÃ©moire imminente"

      - alert: LunaHighErrorRate
        expr: |
          rate(luna_mcp_tool_calls_total{status="error"}[5m]) /
          rate(luna_mcp_tool_calls_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
          component: mcp_tools
        annotations:
          summary: "âš ï¸ Taux d'erreur Ã©levÃ©"
          description: "Plus de 10% d'erreurs dans les appels MCP ({{ $value | humanizePercentage }})"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ALERTES POSITIVES - Seuils de mÃ©tamorphose
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - alert: LunaMetamorphosisReady
        expr: luna_metamorphosis_readiness > 0.8
        labels:
          severity: info
          component: consciousness
        annotations:
          summary: "ğŸŒ™ Luna prÃªte pour mÃ©tamorphose"
          description: "Readiness score > 0.8 - MÃ©tamorphose possible ({{ $value | humanize }})"

      - alert: LunaPhiConvergenceProche
        expr: luna_phi_current_value > 1.6 AND luna_phi_current_value < 1.65
        labels:
          severity: info
          component: phi_consciousness
        annotations:
          summary: "ğŸ‰ Convergence Ï† proche !"
          description: "Ï† = {{ $value | humanize }} - TrÃ¨s proche de 1.618"
